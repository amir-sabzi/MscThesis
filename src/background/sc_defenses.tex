% Section Intro, elaborate on the general theme of the section. 
Now, we explore mitigation approaches proposed to address network side-channel attacks. 
We categorize these approaches into three general classes: (i) Traffic shaping with static profiling (\Cref{subsec:static-traffic-shaping}), (iii) Traffic shaping without pre-profiling (\Cref{subsec:dynamic-traffic-shaping}), (iii) Adversarial Noise (\Cref{subsec:adversarial-noise}).
Our method, the DP traffic shaping, falls into the second category. 
We compare {\sys}'s shaping mechanism with these approaches and highlight their respective strengths and weaknesses.



\section{Traffic Shaping with Static Profiling}\label{subsec:static-traffic-shaping}
These methods typically consist of two distinct phases: the profiling phase and the shaping phase.
The profiling phase is often performed before data transmission on collected network traces.  
During the profiling phase, the shaping mechanism collects user-specific information from the user's traffic traces.
This information can vary and may include details such as the type of traffic pattern (\ie bursty or continuous), distribution of packet sizes, or timing of packet transmission.
The shaping mechanism then leverages this information during the shaping phase to transform users' traffic into a new pattern that ensures privacy with minimal overhead.
We discuss three methods that require static profiling: Traffic Morphing~\cite{wright2009traffic}, Walkie-Talkie~\cite{wang2017walkie}, and Pacer~\cite{mehta2022pacer}.
We chose these three techniques as they represent different approaches to static traffic shaping.
We start with Traffic Morphing in \Cref{subsubsec:traffic-morphing}.
Traffic Morphing changes the distribution of packet sizes of a webpage in a way that they resemble packets generated by another webpage.
In \Cref{subsubsec:walkie-talkie}, we discuss Walkie-Talkie technique.
Walkie-Talkie represents clustering methods, which is one of the most common approaches for traffic shaping with static profiling.
Finally, Pacer is the state-of-the-art in this category of traffic shaping mechanisms, which offers rigorous privacy guarantees while shaping traffic with small overhead.
We provide an overview of Pacer traffic shaping technique in \Cref{subsubsec:background-defenses-pacer}.   

% \todo{Move the next sentence to the end of related work}
% However, scaling static traffic shaping methods is challenging, or even impossible in many cases, due to the need for profiling numerous traffic traces.
% methods we are going to cover:
%% Walkie-Talkie 
%% Supersequence
%% Glove
%% Traffic morphing 
\subsection{Traffic Morphing}\label{subsubsec:traffic-morphing}
In traffic morphing~\cite{wright2009traffic}, the shaping mechanism alters the distribution of packet sizes in such a way that they resemble packets generated by a different website rather than the original website.
Consequently, the attacker fails to map the traffic shape to its content. 
Traffic Morphing (TM) operates based on a technique known as \textit{Direct Target Sampling}.

First it collects the distribution of packets sizes for all websites in the dataset.
Then, Given a webpage $W$, TM randomly selects another webpage $W'$ from the dataset.
When selecting the target webpage $W'$, TM uses an optimization method to choose webpages that result in minimal overhead. 
Upon receiving each packet produced by $W$ with size $l$, TM samples a packet size $l'$ from the distribution of $W'$. 
If $l' > l$, TM pads the outgoing packet with dummy data to match the size $l'$. 
On the other hand, if $l' < l$, TM sends $l'$ bytes and continues sampling from the distribution of $W'$ until all bytes of the original packet have been transmitted.
It is important to emphasize that, unlike {\sys}, the traffic morphing method does not hide the timing or duration of bursts of traffic.
Therefore, an adversary can still exploit these features of traffic traces to potentially reveal users' information, even when traffic morphing is deployed~\cite{dyer2012peek}.


\subsection{Walkie-Talkie}\label{subsubsec:walkie-talkie}
Wang\etalc{wang2017walkie} propose {Walkie-Talkie} as a new defense mechanism implemented in browsers to hide the traffic shape of sensitive websites.
{Walkie-Talkie} requires browser modification to change the default full-duplex communication to half-duplex mode.
In full-duplex communication, multiple servers are actively transmitting web page data to the client, while the client concurrently submits additional resource requests, potentially to different servers.
In half duplex mode, the client sends requests only after the web servers have satisfied all previous requests.
Using half-duplex mode enables {Walkie-Talkie} to change communication to a sequence of bursts of data between one client and one server at a time.
Walkie-Talkie uses a fixed interval to define a burst sequence as a time series, where the size of elements in the time series represents the number of bytes transmitted within the corresponding interval.
For any sensitive website $W$, {Walkie-Talkie} first extracts its burst sequence as a time-series, where each element in the time-series represents the size of the burst.  
Then, using an approach similar to Traffic Morphing~\cite{wright2009traffic}, {Walkie-Talkie} chooses a decoy website $W'$ with a potentially different burst sequence.
For every pair of a sensitive and decoy websites, Walkie-Talkie reshapes the $i$\textsuperscript{th} burst size of them to the maximum of the $i$\textsuperscript{th} burst size in the decoy and the sensitive website. 
Therefore, if an adversary observes the shaped burst sequences, it can not ascertain whether the users accessed $W$ or $W'$.  
Choosing multiple decoy burst sequences for any sensitive webpage can further increase the privacy of {Walkie-Talkie}.

Essentially, {Walkie-Talkie} uses a clustering technique for shaping traffic, conceptually similar to Supersequence~\cite{wang2014supersequence}, Glove~\cite{nithyanand2014glove}, and Tamaraw~\cite{cai2014systematic}.
It maps the traffic shapes of various web pages to the same pattern, effectively rendering them indistinguishable for potential adversaries.
The advantages of the {Walkie-Talkie} are: it adds small overhead compared to other defenses, requires minimal computation to extract the burst sequence of shaped traffic, and stores small metadata for decoy webpages.
It also has several disadvantages. 
First, {Walkie-Talkie} requires browser modification.  
Secondly, similar to most of the traffic shaping methods with static profiling, {Walkie-Talkie} identifies the burst sequence of a webpage before its transmission. 
This is particularly problematic when the burst sequence of a webpage changes due to the network conditions, such as congestion, or application flow control.  
Finally, the adoption of half-duplex mode in browsers imposes a notable constraint on the scalability of this approach, as numerous applications, such as video streaming and file downloading, require multiple and simultaneous communications with web servers.


\subsection{Pacer}\label{subsubsec:background-defenses-pacer}
When discussing our threat model for network side-channel attacks in \Cref{sec:threat-model}, we assumed that the adversary can monitor the underlying network links, thereby enabling it to observe the victim's traffic patterns.
However, this is not the most realistic adversarial scenario one can assume as it is hard for a malicious user to gain control over underlying network links.
Consequently, the scope for adversarial actions becomes restricted primarily to entities of substantial scale such as large corporations and governmental bodies.
In fact, Schuster\etalc{schuster2017beautyburst} show that an adversary, who executes JavaScript client code in the same browser as a victim, can accurately extract traffic pattern of the victim.
Pacer~\cite{mehta2022pacer} extends this threat model to cloud infrastructure, where the adversary deliberately colocates a malicious VM with the victim's VM.
Then, the adversary reveals the shape of the victim's traffic by observing the contention with the malicious VM's traffic.
To mitigate this attack, Pacer \cite{mehta2022pacer} proposes to use a cloaked tunnel.
Pacer's cloaked tunnel is conceptually similar to {\sys}'s shaping tunnel. 
Pacer precisely controls the transmit time of individual
TCP packets in accordance with the shaping schedule and congestion control
signals. 
However, {\sys} relies on post-processing property of DP to ensure that time and sizes of outgoing packets are differentially private. 
Thus, Pacer's tunnel endpoint requires tight integration with, and
non-trivial changes, to the network stack on the end hosts.
To shape traffic, Pacer splits a server's dataset into clusters of a minimum size $k$, while minimizing padding overhead for the dataset.
For each cluster, Pacer then computes a traffic shape based on network traces of all cluster objects.
As a result, within each cluster, traces are indistinguishable for the attacker. 
Nonetheless, similar to other clustering methods, the number of traces within a cluster influences the privacy of the traces it contains.


\section{Traffic Shaping without Pre-profiling}\label{subsec:dynamic-traffic-shaping}
In contrast to the previous approaches, these methods do not require prior profiling of application traces, and the shaping mechanism determines the shape of outgoing traffic directly at transmission time.
Shaping methods without pre-profiling are typically more practical compared to approaches that require profiling, as it can be challenging to profile all possible traffic patterns for sophisticated network applications.
However, ad-hoc decisions regarding the shaping of traffic at the time of transmission can potentially result in information leakage.
We provide an overview of four methods that do not require pre-profiling.
We start with an BuFLO~\cite{dyer2012peek} and its extension CS-BuFLO~\cite{cai2014csbuflo} in \Cref{subsubsec:buflo}. 
These two methods are relaxations of the constant shaping mechanism.
In \Cref{subsubsec:wtf-pad}, we also provide an overview WTF-PAD~\cite{juarez2016toward} as an effort to reduce the overhead of constant-shaping without providing a formal notion of privacy.
We discuss Tamaraw~\cite{cai2014systematic} and its privacy notion as one of few techniques that also provides a formal notion of privacy in \Cref{subsubsec:tamaraw}.
Finally, in \Cref{subsubsec:ditto}, we provide an overview of Ditto~\cite{meier2022ditto} as the state-of-the-art traffic shaping mechanism.  
For each mechanism, we highlight its unique characteristic and discuss its strengths and weaknesses.



\subsection{BuFLO and CS-BuFLO}\label{subsubsec:buflo}
Dyer et al.~\cite{dyer2012peek} conducted a comprehensive study on network side-channel attacks and state-of-the-art defense mechanisms available at the time, providing valuable insight into this field. 
Their negative results showed that none of the countermeasures at the time could completely mitigate network side-channel attacks.
To address this problem, they proposed a shaping mechanism known as Buffered Fixed-Length Obfuscator (BuFLO).
BuFLO can be considered a relaxation of the constant shaping method.
For every given webpage $W$, BuFLO sends fixed-sized packets at constant intervals for a specific duration of time.
If the packet sequence of webpage $W$ takes longer than a threshold, $T$, BuFLO continues sending fixed-sized packets at fixed intervals until transmission is finished, revealing the duration of the flow. 
When all flows have durations shorter than $T$, BuFLO effectively operates similarly to constant shaping.
In such cases, BuFLO inherits the advantages and disadvantages associated with constant shaping methods.~\cite{sirinam2018df}

To address problems associated with BuFLO, Cai~\etal~\cite{cai2014cs} proposed Congestion Sensitive Buffered Fixed-Length Obfuscator (CS-BuFLO).
CS-BuFLO enhances the BuFLO traffic shaping method by applying it bidirectionally, including both the client-to-server and server-to-client directions. 
To optimize network latency and reduce network load, CS-BuFLO dynamically adjusts the frequency of packets at the server side based on the client's transmission rate.
Additionally, to address the issue of fixed transmission durations, CS-BuFLO rounds page sizes to the nearest power of two. 
Overall, CS-BuFLO is a more pragmatic approach for traffic shaping compared to BuFLO. 
However, it is important to note that both the transmission rate adjustment and the padding to powers of two in CS-BuFLO have the potential to leak information.
The authors of CS-BuFLO, however, do not provide a quantification of the extent of information leakage resulting from these mechanisms






\subsection{WTF-PAD}\label{subsubsec:wtf-pad}
WTF-PAD~\cite{juarez2016toward} is a simple generalization of the Adaptive Padding (AP)~\cite{shmatikov2006timing} method used in Tor~\cite{dingledine2004tor}. 
The core shaping mechanism in this method is the same as adaptive padding. 
In adaptive padding, traffic shaping works based on a state machine with three states: \textit{Wait}, \textit{Burst}, and \textit{Gap}. 
The shaping procedure starts in \textit{Wait} state. 
Upon receiving a packet, shaping mechanism state changes to \textit{Burst} mode. 
WTF-PAD measures the inter-arrival time of the next packets. 
If the inter-arrival time is less than a threshold defined in algorithm, it remains in \textit{Burst} state. Otherwise, the state changes to \textit{Gap}.
In \textit{Gap} state, WTF-PAD samples a random variable from a distribution of inter-arrival times for packets during a traffic burst.
This sampled random variable serves as a timer, determining the interval at which the next dummy packet should be transmitted.
When an application sends a packet, the shaping mechanism transitions to the \textit{Burst} state. Otherwise, the mechanism remains in the \textit{Gap} state, continuing to send dummy packets at random intervals. 

Although WTF-PAD pad has zero latency overhead and moderate bandwidth overheads, it provides no formal privacy guarantees.
In fact, multiple new traffic analysis attacks are able to extract users information from their traffic pattern while WTF-PAD is deployed~\cite{sirinam2018df}.


\subsection{Tamaraw}\label{subsubsec:tamaraw}
Cai et al.~\cite{cai2014systematic} conducted a systematic study on network side-channel defenses, proposing a novel notion for privacy in defense mechanisms.
Additionally, they developed a network side-channel defense based on BuFLO~\cite{dyer2012peek} called Tamaraw. 

We summarized their notion of privacy in \Cref{sec:tamaraw-dp-comparison}. Here, we discuss the Tamaraw defense mechanism.



% To disambiguate with {\sys}'s notion of $(\varepsilon, \delta)$-DP, we rename Tamaraw's $\epsilon$ variable with $\gamma$ in this section.
% We show that $(\varepsilon, \delta_{\winlen})$-DP definition is strictly stronger than Tamaraw's $\gamma$-security definition.


Tamaraw's shaping method is almost the same as BuFLO~\cite{dyer2012peek}. The only difference it that instead of padding the total transmission time a fixed length, Tamaraw pads the total number of packets to multiples of a padding parameter $L$.
In other words, if the total number of packets for a webpage $W$ is $n_W$, Tamaraw pads it to a size of $\lceil \frac{n_W}{L} \rceil \times L$.
Increasing $L$ increases Tamaraw' privacy but this results in higher overheads.


\subsection{Ditto}\label{subsubsec:ditto}
The problem of network side channels is well-studied in computer networks.
The focus of the community, however, was mainly on Local Area Networks (LAN) and not on the Wide Area Networks (WAN).
Many large organizations, such as Google, Amazon, and Microsoft, rely on a WAN to connect their data centers.
This makes WANs an attractive target for eavesdropping and traffic analysis attacks, as they often transmit sensitive data.
Techniques that are proposed to address traffic analysis attacks, such as BuFLO~\cite{cai2014cs} and Pacer~\cite{mehta2022pacer}, are designed for Internet applications.
These methods often require modification on software and protocols of end hosts, which is challenging for many large organizations, because it is impossible for cloud providers to modify the software running on a customer instance.
Besides that, WAN traffic is high-throughput in nature, and many proposed solutions are not efficient enough to be used in this context.

Ditto~\cite{meier2022ditto} is a traffic shaping mechanism designed specifically for WAN.
Ditto performs traffic shaping in a programmable switch at the packet-level.
As for the shaping strategy, Ditto sends packets at fixed intervals.
To obfuscate packet sizes, Ditto defines a constant sequence of packet sizes $[L_1, L_2, \dots, L_N]$ and defines a state machine based on packet sizes.
When the shaping mechanism is in state $L_i$, Ditto sends a packet with the size of $L_i$.
If there is a packet in switch queues with a size $L < L_i$, Ditto pads the packet to size $L_i$ and transmits it.
Otherwise, it sends a chaff/dummy packet with size $L_i$.
This guarantees that the size of packet is independent of the input.
Ditto moves between packet states (the size of the next outgoing packet), based on the distribution of overall packet sizes.
For example, if 25\% of packets have size $X$ and 75\% have the size $Y$, Ditto will send the packet sequence of $[X, Y, Y, Y]$.

Ditto adds small latency to users' traffic, as it always transmits data.
However, the bandwidth overhead of the mechanism can potentially become large, as the shape of outgoing traffic is independent of the shape of input.
For example, if the packet sequence defined by Ditto has only one element, the Ditto shaping mechanism is the same as constant shaping.  

\section{Adversarial Noise}\label{subsec:adversarial-noise}
Advances in Machine Learning in general, and Deep Neural Networks (DNNs) in particular, have amplified the inferential capabilities of adversaries in network side-channel attacks~\cite{sirinam2018df}.
Although deep neural networks are powerful in mapping traffic traces of users to their content, they are vulnerable to adversarial examples~\cite{goodfellow2014explaining}.
Adversarial noise involves introducing perturbations to the original input provided to a classifier, leading the classifier to incorrectly classify the input into classes other than the correct one.
Adversarial noise can be used to defeat ML-based network side-channel attacks.
A defense mechanism against network side-channel attacks, constructed using adversarial noise, strategically adds noise with a specific pattern into traffic traces, thereby causing the attacker's model to misclassify them.
Now, we provide an overview of the state-of-the-art defense mechanism based on adversarial noise, WF-GAN. 
Unlike {\sys}, these methods are tailored to a specific classifier, limiting their generalization.
Besides that, adversarial noise does not provide any form of theoretical guarantees.

\subsection{WF-GAN}\label{subsubsec:wf-gan}
WF-GAN~\cite{hou2020wf} has three main components: Generator, Discriminator, and Target Model.
Generator receives a traffic trace, $x$, from the website $W$ and generates adversarial noise, $G(x)$. 
WF-GAN adds the output of the Generator to the input trace, creating an adversarial trace that resembles the traffic trace of another website $W'$.
We represent this trace as $x'$ such that $x'=x + G(x)$.
Then, Discriminator takes the original trace, $x$, and the corresponding adversarial trace, $x'$, as inputs and decides whether an input is a trace of website $W$ or website $W'$.
Therefore, Generator and Discriminator progress together; the former in generating additive noise that can cause traces of $W$ to be classified as $W'$ and the latter in distinguishing these two from each other.
Additionally, WF-GAN uses a state-of-the-art trained DNN model for traffic analysis in the last stage of its pipeline, where the DNN receives the output of the Generator $x'$ and decides whether it is an adversarial traffic trace or not. 
The goal is to create an adversarial trace such that the state-of-the-art model cannot distinguish it from non-adversarial traces.

WF-GAN does not provide any form of theoretical guarantees. 
Moreover, relying on one trained model to adjust the output traffic shape limits the defense's effectiveness to the characteristics of that particular model only.
If the attacker changes its model, the defense mechanism must either be retrained or risk its ability to maintain consistent levels of effectiveness against different attacks.
Finally, adversarial noise defense mechanisms are shown to be vulnerable against adversarial training, a technique wherein the attacker trains their model on a combination of adversarial and original data to effectively differentiate between them~\cite{zhang2019statistical}.
