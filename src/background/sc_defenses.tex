% Section Intro, elaborate on the general theme of the section. 
In this section, we explore mitigation approaches proposed to address network side-channel attacks. 
We categorize these approaches into two general classes: 1- Static shaping methods, 2- Dynamic shaping methods, 3- Adversarial Noise 
\todo{Read the literature and then write about adversarial noise}



\subsection{Static Traffic Shaping}\label{subsec:static-traffic-shaping}
Static traffic shaping methods typically consist of two distinct phases: the profiling phase and the shaping phase.
Profiling phase is often performed before data transmission on collected network traces.  
During the profiling phase, the shaping mechanism collects user-specific information from the user's traffic traces.
This information can vary and may include details such as the type of traffic pattern (\ie bursty or continuous), distribution of packet sizes, or timing of packet transmission.
The shaping mechanism then leverages this information during the shaping phase to transform users' traffic into a new pattern that ensures privacy with minimal overhead.
In this section, we explain three static shaping mechanisms: Traffic Morphing~\cite{wright2009traffic}, Walkie-Talkie~\cite{wang2017walkie}, and Pacer~\cite{mehta2022pacer}.
We chose these three papers as they represent different approaches to static traffic shaping.
Traffic Morphing changes the distribution of packet sizes of a webpage in a way that they resemble packets generated by another webpage.
Walkie-Talkie represents clustering methods, which is one of the most common approaches for static traffic shaping.
Finally, Pacer is the state-of-the-art in this category of traffic shaping mechanisms, which offers rigorous privacy guarantees while shaping traffic with small overheads.   
\todo{Move the next sentence to the end of related work}
However, scaling static traffic shaping methods is challenging, or even impossible in many cases, due to the need for profiling numerous traffic traces.
% methods we are going to cover:
%% Walkie-Talkie 
%% Supersequence
%% Glove
%% Traffic morphing 
\subsubsection{Traffic Morphing}\label{subsubsec:traffic-morphing}
Traffic morphing~\cite{wright2009traffic} is a static approach for traffic shaping. 
In this method, the shaping mechanism alters the distribution of packet sizes in such a way that they resemble packets generated by a different website rather than the original website.
Consequently, the attacker fails to map the traffic shape to its content. 
Traffic Morphing (TM) operates based on a technique known as \textit{Direct Target Sampling}.

First it collects the distribution of packets sizes for all websites in the dataset.
Then, Given a webpage $W$, TM randomly selects another webpage $W'$ from the dataset.
When selecting the target webpage $W'$, TM employs an optimization method to choose webpages that result in minimal overheads. 
Upon receiving each packet produced by $W$ with the size $l$, TM samples a packet size $l'$ from the distribution of $W'$. 
If $l' > l$, TM pads the outgoing packet with dummy data to match the size $l'$. 
On the other hand, if $l' < l$, TM sends $l'$ bytes and continues sampling from the distribution of $W'$ until all bytes of the original packet have been transmitted.
It is important to emphasize that the traffic morphing method does not hide the timing or duration of bursts of traffic.
Therefore, an adversary can still exploit these features of traffic traces to potentially reveal users' information, even when traffic morphing is deployed~\cite{dyer2012peek}.


\subsubsection{Walkie-Talkie}\label{subsubsec:walkie-talkie}
Wang\etalc{wang2017walkie} propose {Walkie-Talkie} as a new defense mechanism implemented in browsers to hide traffic shape of sensitive websites.
{Walkie-Talkie} requires browsers modification to change the default full-duplex communication to half-duplex mode.
In full-duplex communication, multiple servers are actively transmitting web page data to the client, while the client concurrently submits additional resource requests, potentially to different servers.
In half duplex mode, on the other hand, the client only sends requests after the web servers have satisfied all previous requests.
Using half-duplex mode enables {Walkie-Talkie} to change communication to a sequence of bursts of data between one client and one server at a time.
Walkie-Talkie uses a fixed interval to define a burst sequence as a time series, where the size of elements in the time series represents number of bytes transmitted within the corresponding interval.
For any sensitive website $W$, {Walkie-Talkie} first extracts its burst sequence.  
Then, using a similar approach to Traffic Morphing~\cite{wright2009traffic}, {Walkie-Talkie} chooses a decoy website $W'$ with a potentially different burst sequence.
For every pair of a sensitive and decoy websites, Walkie-Talkie reshapes $i$\textsuperscript{th} burst size of them to maximum of $i$\textsuperscript{th} burst size in decoy and sensitive website. 
Therefore, if an adversary observes the shaped burst sequences, it can not ascertain whether the users accessed $W$ or $W'$.  
Choosing multiple decoy burst sequences for any sensitive can further increase the privacy of {Walkie-Talkie}.

Essentially, {Walkie-Talkie} use as a clustering technique for shaping traffic, conceptually similar to Supersequence~\cite{wang2014supersequence}, Glove~\cite{nithyanand2014glove}, and Tamaraw~\cite{cai2014systematic}.
It maps the traffic shapes of various web pages to the same pattern, effectively rendering them indistinguishable for potential adversaries.
The advantages of the {Walkie-Talkie} are: it adds small overheads compared to other defenses, requires minimal computation to extract the burst sequence of shaped traffic, and stores small metadata to for decoy webpages.
On the other hand, it has several disadvantages. 
First, {Walkie-Talkie} requires browser modification.  
Secondly, similar to most of the static traffic shaping methods, {Walkie-Talkie} identifies the burst sequence of a webpage before its transmission. 
This is particularly problematic when the burst sequence of a webpage changes due to the network conditions, such as congestion, or application flow control.  
Finally, the adoption of half-duplex mode in browsers imposes a notable constraint on the scalability of this approach, as numerous applications, such as video streaming and file downloading, require multiple and simultaneous communications with web servers.


\subsubsection{Pacer}
When discussing our threat model for network side channel leaks in \Cref{subsec:threat-model}, we assumed that the adversary exerts control over the underlying network links, thereby enabling it to observe the victim's traffic patterns.
However, this is not the most realistic adversarial scenario one can assume as it is hard for a malicious user to gain control over underlying network links.
Consequently, the scope for adversarial actions becomes restricted primarily to entities of substantial scale such as large corporations and governmental bodies.
In fact, Schuster\etalc{schuster2017beautyburst} show that an adversary who executes a JavaScript client code in the same browser as victim can accurately extract traffic pattern of the victim.
Pacer~\cite{mehta2022pacer} extends this threat model to cloud infrastructure, where the adversary deliberately colocates a malicious VM with victim's VM.
Then, the adversary reveals the shape of victim's traffic by observing the contention with the malicious VM's traffic.
To mitigate this attack, Pacer \cite{mehta2022pacer} proposes the idea of a cloaked tunnel.
Pacer's cloaked tunnel precisely controls the transmit time of individual
TCP packets in accordance with the shaping schedule and congestion control
signals.
Thus, Pacer's tunnel endpoint requires tight integration with and
non-trivial changes to the network stack on the end hosts.
To shape traffic, Pacer splits a server's dataset into clusters of a minimum size $k$, while minimizing padding overhead for the dataset.
For each cluster, Pacer then computes a traffic shape based on network traces of all cluster objects.
As a result, within each cluster, traces are indistinguishable for the attacker. 
Nonetheless, similar to other clustering methods, the number of traces within a cluster influences the privacy of the traces it contains.


\subsection{Dynamic Traffic Shaping}\label{subsec:dynamic-traffic-shaping}
In contrast to the static approaches, dynamic shaping approaches do not require prior profiling of application traces and the shaping mechanism determines the shape of outgoing traffic directly at the transmission time.
These methods are typically more practical compared to static approaches, as it can be challenging to profile all possible traffic patterns for sophisticated network applications.
On the other hand, ad-hoc decisions regarding the shaping of traffic at the time of transmission can potentially result in information leakage.
In this section, we provide an overview of four dynamic traffic shaping methods.
We start with an BuFLO~\cite{dyer2012peek}, and its extension CS-BuFLO~\cite{cai2014csbuflo}. These two methods are relaxation of constant shaping mechanism.
We, then, provide and overview WTF-PAD~\cite{juarez2016toward} as an effort to reduce overheads of constant-shaping without providing a formal notion of privacy.
We explain Tamaraw~\cite{cai2014systematic} and its privacy notion as one of the a few related works that also provides a formal notion of privacy.
Finally, we provide an overview of Ditto~\cite{meier2022ditto} as the state-of-the-art dynamic traffic shaping mechanism.  
For each mechanism, we highlight their unique characteristics, and discuss their strengths and weaknesses.



\subsubsection{BuFLO and CS-BuFLO}\label{subsubsec:buflo}
Dyer et al.~\cite{dyer2012peek} conducted a comprehensive study on network side-channel attacks and state-of-the-art defense mechanisms available at the time, providing valuable insights into this field. 
Their negative results showed that none of the countermeasures at the time could completely mitigate network side-channel attacks.
To address this problem, they proposed a shaping mechanism known as Buffered Fixed-Length Obfuscator (BuFLO).
BuFLO can be considered as a relaxation of the constant shaping method.
For every given webpage $W$, BuFLO sends fixed-sized packets at constant intervals for a specific duration of time.
We represent packet sizes with $p$, packet frequency with $f$, and the sending duration with $T$. 
If the packet sequence of webpage $W$ takes longer than the specified time $T$, BuFLO continues sending fixed-sized packets at fixed intervals until transmission is finished, revealing the duration of the flow. 
When all flows have durations shorter than $T$, BuFLO effectively operates similarly to constant shaping.
In such cases, BuFLO inherits the advantages and disadvantages associated with the constant shaping method.~\cite{sirinam2018df}

To address problems associated with BuFLO, Cai~\etal~\cite{cai2014cs} proposed Congestion Sensitive Buffered Fixed-Length Obfuscator (CS-BuFLO).
CS-BuFLO enhances the BuFLO traffic shaping method by applying it bidirectionally, encompassing both the client-to-server and server-to-client directions. 
To optimize network latency and reduce network load, CS-BuFLO dynamically adjusts the frequency of packets at the server side based on the client's transmission rate.
Additionally, to address the issue of fixed transmission durations, CS-BuFLO rounds page sizes to the nearest power of two. 
Overall, CS-BuFLO is a more pragmatic approach to perform traffic shaping compared to BuFLO. 
However, it is important to note that both the transmission rate adjustment and the padding to powers of two in CS-BuFLO have the potential to leak information.
The authors of CS-BuFLO, however, do not provide a quantification of the extent of information leakage resulting from these mechanisms






\subsubsection{WTF-PAD}\label{subsubsec:wtf-pad}
WTF-PAD~\cite{juarez2016toward} is a simple generalization of Adaptive Padding (AP)~\cite{shmatikov2006timing} method to be used in Tor~\cite{dingledine2004tor}. 
The core shaping mechanism in this method is the same as adaptive padding. 
In adaptive padding, traffic shaping works based on a state machine with three states: \textit{Wait}, \textit{Burst}, and \textit{Gap}. 
The shaping procedure starts in \textit{Wait} state. 
Upon receiving a packet, shaping mechanism state changes to \textit{Burst} mode. 
WTF-PAD measures the inter-arrival time of the next packets. 
If the inter-arrival time is less than a threshold defined in algorithm, it remains in \textit{Burst} state. Otherwise, the states changes to \textit{Gap}.
In \textit{Gap} state, WTF-PAD samples a random variable from a distribution of inter-arrival times for packets during traffic burst.
This sampled random variable serves as a timer, determining the interval at which the next dummy packet should be transmitted.
When an application sends a packet, the shaping mechanism transitions to the \textit{Burst} state. Otherwise, the mechanism remains in the \textit{Gap} state, continuing to send dummy packets at random intervals. 

Although WTF-PAD pad has zero latency overhead and moderate bandwidth overheads, it provides no formal privacy guarantees.
In fact, multiple new traffic analysis attacks are able to extract users information from their traffic pattern while WTF-PAD is deployed~\cite{sirinam2018df}.


\subsubsection{Tamaraw}\label{subsubsec:tamaraw}
Cai et al.~\cite{cai2014systematic} conducted a systematic study on network side-channel defenses, proposing a novel notion for privacy in defense mechanisms.
Additionally, they developed a network side-channel defense based on BuFLO~\cite{dyer2012peek} called Tamaraw. 
We first overview their notion of privacy, and then, discuss Tamaraw defense mechanism.


Tamaraw \cite{cai2014tamaraw} provides a
mathematical notion of privacy guarantee of a shaping strategy, called $\epsilon$-security.
To disambiguate with {\sys}'s notion of $(\varepsilon, \delta)$-DP, we rename Tamaraw's $\epsilon$ variable with $\gamma$ in this section.
We show that $(\varepsilon, \delta_{\winlen})$-DP definition is strictly stronger than Tamaraw's $\gamma$-security definition.
We start by explaining Tamaraw's definition.
\\
\noindent
Tamaraw defines $W$ as the random variable that represents the label of a
traffic trace.
For each traffic trace, $w$, let $T_{w}$ $T_{w}^{D}$ be the random variables representing
the packet trace of $w$ before and after applying shaping on $w$ respectively.
The distribution of $T_{w}^D$ encompasses all variations in observed
patterns of a trace $w$ resulting from both the defense mechanism and the
network, and the distribution of $T_{w}$ only captures the randomness added in the network.
The attacker can measure the distribution of $W$ and $T_{w}^{D}$ independently.
\\
\noindent
Upon observing a trace $t$ on the network, an optimal attack $A$, selects the
label that corresponds to the maximum likelihood of observing that trace.
\begin{equation*}
  A(t) = \argmax_{w}{\Pr[W=w]\Pr[T_{w}^{D}=t]}
\end{equation*}
For any attack $A$, we represent the probability that attack output the label $w_i$ with $\Pr_A[w_i]$.
\begin{definition}[Tamaraw $\gamma$-privacy]
  A fingerprinting defense $D$ is said to be uniformly $\gamma$-private if for the attack $\mathcal{A}$ if we have:
  \begin{equation*}
    \max_w\big[\Pr[A(T_w^D)=w]\big] \leq \gamma
  \end{equation*}
\end{definition}

\begin{proposition}
  Tamaraw $\gamma$-privacy is strictly weaker than the notion of $(\varepsilon, 0)$-differential privacy.
\end{proposition}
\noindent
To prove the above proposition, we need to prove the following two lemmas.

\begin{lemma-numbered}
  There exists a Tamaraw $\gamma$-private defense mechanism that fails to satisfy $(\varepsilon, 0)$-differential privacy for any given value of $\varepsilon$.
\end{lemma-numbered}
\begin{proof}
%  Assume a closed-world setup of $n$ webpages.
    Consider a web service with a dataset of $n$ web pages.
    We propose the following defense mechanism, $D$, with two parameters $\alpha$ and $\beta$:
    \begin{enumerate}
    \item For the webpage $w_i: i=j$, $D$ reshapes it to the constant-rate pattern, $O_c$, with probability $\beta$. Otherwise, with probability $1-\beta$, it reveals the original traffic pattern of the webpage, $T_{w_{i=j}}$.
    \item For any webpage $w_i: i \in \{1, 2, \dots, j-1, j+1, \dots, n\}$, $D$ reshapes it to the constant-rate pattern, $O_c$, with probability $\alpha$ such that $\alpha > {e^{\varepsilon}}\beta$. Otherwise, $D$ reveals the original pattern of $w_i$, $T_{w_{i\neq j}}$, with probability $\alpha$.
    \end{enumerate}
    The probability that any attack can correctly identify the label for webpage $w_j$ is upper-bounded by:

    \begin{align*}
      & \Pr[A(T^{D}_{w_{i=j}}) = w_j]
      \\
      & = \Pr[A(T^D_{w_{i=j}}) = w_j | T^D_{w_{i=j}}=T_{w_{i=j}}]\Pr[T^D_{w_{i=j}}=T_{w_{i=j}}] +
      \\
      &~~~~\Pr[A(T^D_{w_{i=j}}) = w_j | T^D_{w_{i=j}}=O_c]\Pr[T^D_{w_{i=j}}=O_c]
      \\
      & \leq  1.(1-\beta) + \frac{1}{n}\beta = p_c^j
    \end{align*}
    For $(1- \frac{n\gamma - 1}{n-1}) < \beta$ we have: $p_c^j \leq \gamma$.
    \\
    Similarly, the probability that any attack can correctly classify $w_{i\neq j}$ is upper-bounded by $p_c^i = 1-\alpha + \frac{\alpha}{n}$, and for $(1- \frac{n\gamma - 1}{n-1}) < \alpha$ we have: $p_c^j \leq \gamma$.
    Therefore, for all values of $\alpha$ and $\beta$ such that $(1- \frac{n\gamma -
    1}{n-1}) < \beta < \alpha$, the probability that any attack can successfully
    guess victim traffic stream in both cases is less than $\gamma$, and
    the defense is uniformly $\gamma$-private.
    \\
    When the output of the algorithm is a constant pattern, $O_{c}$, with the probability $\beta$ the original webpage is $j$, and with probability $\alpha$, it can be any other webpages. Thus, we have:
    \begin{equation*}
    \log(\frac{\Pr[T_{w_{i\neq j}}^{D}=O_{c}]}{\Pr[T_{w_{i=j}}^{D}=O_{c}]})
    = \log(\frac{\alpha}{\beta}) > \varepsilon
    \end{equation*}
  Therefore, it fails to guarantee $\varepsilon$-differential privacy.
\end{proof}


\begin{lemma-numbered}
  A $(\varepsilon, 0)$-differentially private shaping algorithm is Tamaraw $\gamma$-private for:
  \begin{equation*}
    \varepsilon \leq \log(n\gamma)
  \end{equation*}
\end{lemma-numbered}
\begin{proof}
  For a given trace, $w$, the random variable $T_{w}^{DP}$ represents packet
  trace of $w$ after  a differentially private shaping mechanism is applied.
  \\
  The classification attack on shaped traffic analysis the shaped traces so it can be considered as post-processing of the results of a
  differentially private shaping mechanism (i.e. defense), and is differentially
  private. Therefore,
  we have:
  \begin{align*}
    \frac{\Pr[A(T_{w_{i}}^{DP}) = w_i]}{\Pr[A(T_{w_{j}}^{DP}) = w_i]} \leq e^
    {\varepsilon}
    \\
    \rightarrow \Pr[A(T_{w_{i}}^{DP}) = w_i] \leq e^
    {\varepsilon} .\Pr[A(T_{w_{j}}^{DP}) = w_i]
  \end{align*}
  Intuitively, this implies that the likelihood of the attacker correctly classifying the trace with label $i$ compared to incorrectly classifying it with label $j$ is bounded by $e^{\varepsilon}$.
  The above inequality is correct for all $w_j: j\in \{1, 2, \dots, n\}$, therefore we can calculate the summation over $j$.
  Extending the above equation we have:
  \begin{align*}
    n\times \Pr[A(T_{w_{i}}^{DP}) = w_i] \leq e^{\varepsilon}\sum_{j=1}^{n} \Pr[A(T_{w_{j}}^{DP}) = w_i] \\
    = e^{\varepsilon} \operatorname{Pr}_{A}[w_i]
  \end{align*}
  where $\Pr_{A}[w_i]$ is the probability that attack $A$ outputs the label
  $w_i$.
  Therefore, for any given trace $w_i$, the probability that any attack $A$, classifies it correctly is bounded by:
  \begin{equation*}
    \Pr[A(T_{w_{i}}^{DP}) = w_i] \leq \frac{e^{\varepsilon} \Pr_{A}[w_i]}{n}
  \end{equation*}
  Therefore, the probability that an attacker can guess the victimâ€™s trace is bounded by:
  \begin{align*}
    \max_{w_i}{\Pr[A(T_{w_{i}}^{DP}) = w_i]} \leq \frac{e^{\varepsilon}}{n} \max_{w_i}{\operatorname{Pr}_{A}[w_i]} \leq \frac{e^{\varepsilon}}{n} \leq \gamma
  \end{align*}
\end{proof}
\noindent
Putting the two lemmas together, we prove that the notion of differential
privacy is strictly stronger than Tamaraw's.

Tamaraw's shaping method is almost the same as BuFLO~\cite{dyer2012peek}. The only difference it that instead of padding the total transmission time a threshold $T$, Tamaraw pads the total number of packets to multiples of a padding parameter $L$.
In other words, if the total packet number for a webpage $W$ is $n_W$, Tamaraw pads it to a size of $\lceil \frac{n_W}{L} \rceil \times L$.
As the value of $L$ increases, Tamaraw offers enhanced privacy; however, this also results in higher overheads.


\subsubsection{Ditto}
The problem of network side channels is well-studied in computer networks.
The focus of the community, however, was mainly on Internet application and not on the Wide Area Networks (WAN).
Many large organizations, such as Google, Amazon, and Microsoft, rely on WAN to connect their data centers.
This makes WANs an attractive target for eavesdropping and traffic analysis attacks as they often transmit sensitive data.
Techniques that are proposed to address traffic analysis attacks, such as BuFLO~\cite{cai2014cs} and Pacer~\cite{mehta2022pacer} are designed for Internet applications and require modification on software and protocols of end hosts which is challenging for many large organizations because it is impossible for cloud providers to modify the software running on the customer instance.
Besides that, WAN traffic is high-throughput in nature, and many proposed solutions are not efficient enough to be used in this context.

Ditto~\cite{meier2022ditto} is a traffic shaping mechanism designed specifically for WAN.
Ditto performs traffic shaping in a programmable switch at packet-level.
As for the shaping strategy, Ditto sends packets at fixed intervals.
To obfuscate packet sizes, Ditto defines a constant sequence of packet sizes $[L_1, L_2, \dots, L_N]$ and defines a state machine based on packet sizes.
When the shaping mechanism is at state $L_i$, Ditto sends a packet out with the size of $L_i$.
If there is a packet in switch queues with a size $L < L_i$, Ditto pads the packet to size $L_i$ and transmits it.
Otherwise, it sends a chaff/dummy packet with size $L_i$.
This guarantees that the size of packet is independent of the input.
Ditto moves between packet states (the size of the next outgoing packet), based on the distribution of overall packet sizes.
For example, if packets in 25\% of the time have size $X$ and have the size $Y$ in other 75\% of the transmission, Ditto will send the packet sequence of $[X, Y, Y, Y]$.

Ditto adds small latency to users' traffic as it always transmits data.
However, the bandwidth overheads of the mechanism can potentially become large as the shape of outgoing traffic is independent of the shape of input.
For example, if the packet sequence defined by Ditto has only one element, Ditto shaping mechanism is the same as constant shaping.  
\subsection{Adversarial Noise}





